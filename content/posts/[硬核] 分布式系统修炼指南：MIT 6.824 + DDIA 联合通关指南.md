+++
date = '2025-11-21T20:11:37+08:00'
draft = false
title = '[ç¡¬æ ¸] åˆ†å¸ƒå¼ç³»ç»Ÿä¿®ç‚¼æŒ‡å—ï¼šMIT 6.824 + DDIA è”åˆé€šå…³æŒ‡å—'
categories = ["åˆ†å¸ƒå¼ç³»ç»Ÿ", "å­¦ä¹ è·¯çº¿"]
tags = ["åˆ†å¸ƒå¼", "MIT 6.824", "DDIA", "æ•°æ®å¯†é›†å‹åº”ç”¨", "Raft", "Go"]
series = ["åˆ†å¸ƒå¼ç³»ç»Ÿå­¦ä¹ "]
+++

## å‰è¨€ï¼šä¸ºä»€ä¹ˆé€‰æ‹©è¿™æ¡è·¯ï¼Ÿ

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„å­¦ä¹ è·¯å¾„ä¸­ï¼Œæœ‰ä¸¤åº§å…¬è®¤çš„å¤§å±±ï¼š

1. **ç†è®ºåœ£ç»**ï¼šã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹(DDIA) â€”â€” æ•™ä½ "æ€ä¹ˆé€‰"ã€"æ€ä¹ˆè®¾è®¡"
2. **å®è·µå·…å³°**ï¼šMIT 6.824 (Distributed Systems) â€”â€” æ•™ä½ "æ€ä¹ˆåš"ã€"æ€ä¹ˆå®ç°"

å¾ˆå¤šäººåˆ†å¼€å­¦ï¼Œç»“æœå¾€å¾€æ˜¯ï¼šçœ‹äº†ä¹¦è§‰å¾—æ‡‚äº†ï¼Œä¸€å†™ä»£ç å°±å´©ï¼›æˆ–è€…é—·å¤´å†™ä»£ç ï¼Œå´ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ã€‚

> ğŸ’¡ è¿™ä»½è®¡åˆ’æ—¨åœ¨å°†ç†è®º(DDIA)ä¸å®è·µ(MIT 6.824)æ·±åº¦èåˆï¼ŒåŠ©ä½ ä»åŸæœ¬çš„"CRUDå·¥ç¨‹å¸ˆ"è¿›é˜¶ä¸ºçœŸæ­£çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘è€…ã€‚

---

## 0. å‡†å¤‡å·¥ä½œ(é¢„å¤‡å‘¨)

### è¯­è¨€åŸºç¡€

MIT 6.824 Labså…¨ç¨‹ä½¿ç”¨Goè¯­è¨€ã€‚

**Action**: å®Œæˆ[A Tour of Go](https://tour.golang.org/)

é‡ç‚¹æ”»å…‹ä»¥ä¸‹Goå¹¶å‘åŸè¯­ï¼š

```go
// éœ€è¦ç†Ÿç»ƒæŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ
- Goroutines      // è½»é‡çº§çº¿ç¨‹
- Channels        // åç¨‹é—´é€šä¿¡
- Mutex/RWMutex   // äº’æ–¥é”å’Œè¯»å†™é”
- sync.Cond       // æ¡ä»¶å˜é‡
```

### å¿ƒæ€å‡†å¤‡

âš ï¸ **è­¦å‘Š**ï¼šè¿™ä¸ä¼šå¾ˆå®¹æ˜“ã€‚Lab 2(Raft)å¯èƒ½ä¼šè®©ä½ æ€€ç–‘äººç”Ÿï¼Œè¯·åšå¥½å¿ƒç†å‡†å¤‡ã€‚

---

## Phase 1: åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³(1-2å‘¨)

**ç›®æ ‡**ï¼šç†è§£åˆ†å¸ƒå¼å­˜å‚¨çš„åŸºæœ¬å½¢æ€ï¼Œä¹ æƒ¯RPCç¼–ç¨‹ã€‚

### ğŸ“– é˜…è¯»(DDIA)

- **Ch 5: Replication(å¤åˆ¶)** - é‡ç‚¹ç†è§£Leader-based replicationï¼Œè¿™æ˜¯GFSå’ŒRaftçš„åŸºç¡€
- **Ch 1: Reliable, Scalable, Maintainable** - å»ºç«‹å®è§‚æ¦‚å¿µ

### ğŸ’» è¯¾ç¨‹(MIT 6.824)

- **Lecture**: MapReduce, GFS(å¯ä»¥åªçœ‹è®²ä¹‰/è®ºæ–‡ï¼Œè§†é¢‘é€‰çœ‹)
- **Lab 1: MapReduce** - å®ç°ä¸€ä¸ªç®€å•çš„å•è¯è®¡æ•°å™¨
  - é‡ç‚¹ï¼šç†Ÿæ‚‰RPCæ¡†æ¶
  - éš¾ç‚¹ï¼šé€‚åº”Debugåˆ†å¸ƒå¼ç¨‹åºçš„ç—›è‹¦

### âœ… é˜¶æ®µç›®æ ‡

- [ ] ç†è§£Master-Workeræ¶æ„
- [ ] èƒ½å¤Ÿä½¿ç”¨Goçš„RPCåº“
- [ ] æŒæ¡åŸºæœ¬çš„åˆ†å¸ƒå¼è°ƒè¯•æŠ€å·§

---

## Phase 2: æ ¸å¿ƒéš¾å…³â€”â€”å…±è¯†ç®—æ³•Raft(3-5å‘¨)

**ç›®æ ‡**ï¼šè¿™æ˜¯æ•´ä¸ªè®¡åˆ’ä¸­æœ€éš¾ã€å«é‡‘é‡æœ€é«˜çš„éƒ¨åˆ†ã€‚**åˆ‡å‹¿æ±‚å¿«ï¼**

### ğŸ“– é˜…è¯»(DDIA)

- **Ch 9: Consistency and Consensus** - ğŸ”¥å¿…è¯»ï¼åœ¨å†™ä»£ç å‰ï¼Œå…ˆç†è§£ä»€ä¹ˆæ˜¯çº¿æ€§ä¸€è‡´æ€§(Linearizability)ï¼Œä»¥åŠä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦Consensus
- **Ch 8: The Trouble with Distributed Systems** - äº†è§£ç½‘ç»œåˆ†åŒºã€æ—¶é’Ÿæ¼‚ç§»ã€‚åšLabæ—¶ä½ ä¼šäº²èº«ä½“ä¼šåˆ°è¿™äº›"éº»çƒ¦"

### ğŸ’» è¯¾ç¨‹(MIT 6.824)

- **Lecture**: Raft(1)&(2)
  - ğŸ’¡ å¼ºçƒˆå»ºè®®çœ‹è§†é¢‘ï¼ŒRobert Morrisæ•™æˆçš„ç™½æ¿æ¼”ç¤ºå¯¹ç†è§£é€‰ä¸»å’Œæ—¥å¿—å¤åˆ¶è‡³å…³é‡è¦

- **Lab 2: Raft**
  - **2A: é€‰ä¸»(Leader Election)**
  - **2B: æ—¥å¿—å¤åˆ¶(Log Replication)** â€”â€” âš ï¸éš¾åº¦é™¡å¢ç‚¹
  - **2C: æŒä¹…åŒ–(Persistence)**

### ğŸš€ ç”Ÿå­˜æŠ€å·§

> âš¡ **å…³é”®å»ºè®®**ï¼šä¸è¦ä¸€ä¸Šæ¥å°±å†™ä»£ç ï¼å…ˆç”»çŠ¶æ€æœºæµè½¬å›¾ï¼ä¸¥æ ¼éµå¾ªè®ºæ–‡Figure 2ã€‚

```go
// æ¨èçš„Raftè°ƒè¯•æ–¹æ³•
type Raft struct {
    // ...
}

func (rf *Raft) DPrintf(format string, a ...interface{}) {
    if Debug {
        log.Printf("[Raft %d] " + format, append([]interface{}{rf.me}, a...)...)
    }
}
```

### âœ… é˜¶æ®µç›®æ ‡

- [ ] é€šè¿‡æ‰€æœ‰Raftæµ‹è¯•(å¯èƒ½éœ€è¦è¿è¡Œ1000æ¬¡æ‰èƒ½å‘ç°éšè—bug)
- [ ] ç†è§£ä»€ä¹ˆæ˜¯split brainå’Œå¦‚ä½•é¿å…
- [ ] æŒæ¡ä½¿ç”¨æ—¥å¿—è°ƒè¯•å¤šçº¿ç¨‹ç¨‹åº

---

## Phase 3: æ„å»ºé«˜å¯ç”¨KVæœåŠ¡(2-3å‘¨)

**ç›®æ ‡**ï¼šåœ¨Raftä¹‹ä¸Šæ„å»ºåº”ç”¨ï¼Œå¤„ç†å®¢æˆ·ç«¯çš„é‡è¯•å’Œå¹‚ç­‰æ€§ã€‚

### ğŸ“– é˜…è¯»(DDIA)

- **Ch 7: Transactions** - ç†è§£ACIDï¼Œç‰¹åˆ«æ˜¯éš”ç¦»çº§åˆ«ã€‚è™½ç„¶Lab 3ä¸»è¦æ˜¯çº¿æ€§ä¸€è‡´æ€§ï¼Œä½†ç†è§£äº‹åŠ¡æœ‰åŠ©äºæ€è€ƒå¹¶å‘è¯·æ±‚çš„å¤„ç†

### ğŸ’» è¯¾ç¨‹(MIT 6.824)

- **Lab 3: Key-Value Service**
  - **3A: æ— å¿«ç…§ç‰ˆKV**
  - **3B: å¸¦å¿«ç…§(Snapshot)** â€”â€” ç»“åˆRaftçš„æ—¥å¿—å‹ç¼©

### ğŸ¤” æ ¸å¿ƒæŒ‘æˆ˜

**é—®é¢˜**ï¼šå¦‚ä½•ä¿è¯å³ä½¿Clienté‡å‘è¯·æ±‚ï¼Œæ“ä½œä¹Ÿåªæ‰§è¡Œä¸€æ¬¡(Exactly-once semantics)ï¼Ÿ

**æç¤º**ï¼š

```go
type KVServer struct {
    // éœ€è¦ç»´æŠ¤clientçš„è¯·æ±‚åºåˆ—å·
    clientSeq map[int64]int64  // clientId -> lastSeqNum
    results   map[int64]string // seqNum -> result
}
```

### âœ… é˜¶æ®µç›®æ ‡

- [ ] å®ç°å¹‚ç­‰æ€§ä¿è¯
- [ ] ç†è§£å¿«ç…§ä¸æ—¥å¿—å‹ç¼©çš„å…³ç³»
- [ ] æŒæ¡å¦‚ä½•åœ¨Raftä¹‹ä¸Šæ„å»ºåº”ç”¨

---

## Phase 4: ç»ˆææŒ‘æˆ˜â€”â€”åˆ†ç‰‡ä¸æ‰©å®¹(2-4å‘¨)

**ç›®æ ‡**ï¼šä»å•Raft Groupæ‰©å±•åˆ°å¤šGroupï¼Œå®ç°çœŸæ­£çš„æ°´å¹³æ‰©å±•ã€‚

### ğŸ“– é˜…è¯»(DDIA)

- **Ch 6: Partitioning(åˆ†ç‰‡)** - ç†è§£Rebalancing(å†å¹³è¡¡)ç­–ç•¥

### ğŸ’» è¯¾ç¨‹(MIT 6.824)

- **Lab 4: Sharded KV**
  - å®ç°**ShardCtrler**(é…ç½®ç®¡ç†)
  - å®ç°**ShardKV**(åˆ†ç‰‡æ•°æ®å­˜å‚¨)

### ğŸ’€ æ ¸å¿ƒéš¾ç‚¹

1. é…ç½®æ›´æ–°æ—¶ï¼Œæ•°æ®å¦‚ä½•åœ¨ä¸åŒGroupé—´è¿ç§»ï¼Ÿ
2. å¦‚ä½•å¤„ç†é…ç½®å˜æ›´æœŸé—´çš„è¯·æ±‚ï¼Ÿ
3. å¦‚ä½•é¿å…æ­»é”ï¼Ÿ

### âš ï¸ å¸¸è§é™·é˜±

- é…ç½®ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„æ•°æ®ä¸¢å¤±
- Shardè¿ç§»æ—¶çš„å¹¶å‘é—®é¢˜
- ä½¿ç”¨é”™è¯¯çš„Groupå¤„ç†è¯·æ±‚

### âœ… é˜¶æ®µç›®æ ‡

- [ ] å®ç°åŠ¨æ€åˆ†ç‰‡
- [ ] å¤„ç†é…ç½®å˜æ›´
- [ ] é€šè¿‡æ‰€æœ‰Sharded KVæµ‹è¯•

---

## å­¦ä¹ ç­–ç•¥å»ºè®®(Efficiency vs. Depth)

### 1. Paper First ğŸ“„

è®ºæ–‡æ˜¯ç¬¬ä¸€æ‰‹èµ„æ–™ï¼Œå¿…é¡»ç¡¬å•ƒã€‚æ¨èé˜…è¯»é¡ºåºï¼š

- MapReduceè®ºæ–‡
- GFSè®ºæ–‡
- **Raftè®ºæ–‡**(In Search of an Understandable Consensus Algorithm)
- å¦‚æœè¿˜æœ‰ç²¾åŠ›ï¼šSpannerã€Frangipaniç­‰

### 2. DDIAè¾…åŠ© ğŸ“š

çœ‹ä¸æ‡‚è®ºæ–‡é€»è¾‘æ—¶ï¼Œç¿»DDIAå¯¹åº”ç« èŠ‚ï¼Œé€šå¸¸ä¼šæœ‰é«˜å±‹å»ºç“´çš„è§£é‡Šã€‚

### 3. è§†é¢‘æŒ‰éœ€ ğŸ¥

Raftéƒ¨åˆ†å»ºè®®çœ‹è§†é¢‘ï¼Œå…¶ä»–éƒ¨åˆ†å¦‚æœçœ‹è®²ä¹‰èƒ½æ‡‚ï¼Œå¯è·³è¿‡è§†é¢‘ä»¥èŠ‚çœæ—¶é—´ã€‚

### 4. DebugæŠ€å·§ ğŸ›

```go
// å–„ç”¨æ¡ä»¶æ‰“å°
const Debug = true

func DPrintf(format string, a ...interface{}) {
    if Debug {
        log.Printf(format, a...)
    }
}

// ä½¿ç”¨go testçš„-raceå‚æ•°æ£€æµ‹ç«æ€æ¡ä»¶
// go test -race -run TestXXX
```

å¤šçº¿ç¨‹è°ƒè¯•æ˜¯åŸºæœ¬åŠŸï¼Œæ¨èå·¥å…·ï¼š

- Goçš„`-race`æ£€æµ‹å™¨
- å¤§é‡æ—¥å¿—+æ—¶é—´æˆ³
- å¯è§†åŒ–å·¥å…·ï¼šå¦‚[Raft Scope](https://github.com/ongardie/raftscope)

---

## æ—¶é—´è§„åˆ’æ€»è§ˆ

| é˜¶æ®µ | å†…å®¹ | é¢„è®¡æ—¶é—´ | éš¾åº¦ |
|------|------|----------|------|
| Phase 0 | å‡†å¤‡å·¥ä½œ | 1å‘¨ | â­ |
| Phase 1 | MapReduce + GFS | 1-2å‘¨ | â­â­ |
| Phase 2 | Raftå…±è¯†ç®—æ³• | 3-5å‘¨ | â­â­â­â­â­ |
| Phase 3 | KVæœåŠ¡ | 2-3å‘¨ | â­â­â­â­ |
| Phase 4 | åˆ†ç‰‡ç³»ç»Ÿ | 2-4å‘¨ | â­â­â­â­â­ |

**æ€»è®¡**ï¼š9-15å‘¨(çº¦2-4ä¸ªæœˆ)

---

## ç»“è¯­

é€šå…³MIT 6.824 + DDIAä¸ä»…æ˜¯ç®€å†ä¸Šçš„äº®ç‚¹ï¼Œæ›´æ˜¯ä½ å¯¹è®¡ç®—æœºç³»ç»Ÿè®¤çŸ¥çš„é‡å¡‘ã€‚

å½“ä½ ç»ˆäºçœ‹ç€æ‰€æœ‰Testå˜ç»¿(Passed)æ—¶ï¼š

```bash
Test: one client (3A) ...
  ... Passed -- 15.0  5  1419  0
Test: many clients (3A) ...
  ... Passed -- 15.5  5  3496  0
Test: unreliable (3A) ...
  ... Passed -- 18.2  5  1786  0
...
ok  	6.824/kvraft	107.123s
```

é‚£ç§æˆå°±æ„Ÿæ— ä¸ä¼¦æ¯”ã€‚ğŸ‰

**åŠ æ²¹ï¼Œæœªæ¥çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸“å®¶ï¼** ğŸ’ª

---

## å‚è€ƒèµ„æ–™

- [MIT 6.824è¯¾ç¨‹ä¸»é¡µ](https://pdos.csail.mit.edu/6.824/)
- [Raftè®ºæ–‡](https://raft.github.io/raft.pdf)
- [DDIAä¸­æ–‡ç‰ˆ](https://github.com/Vonng/ddia)
- [å­¦ç”Ÿçš„Labç»éªŒåˆ†äº«](https://thesquareplanet.com/blog/students-guide-to-raft/)